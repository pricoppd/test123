stages {
        stage("Run Ansible Deployment") {
            steps {
                script {
                    def ansibleVarsFile = readFile('ansible_vars.json')
                    def ansibleVars = new groovy.json.JsonSlurper().parseText(ansibleVarsFile)
                    
                    echo "Available top-level keys in ansibleVars: ${ansibleVars.keySet()}"
                    
                    if(ansibleVars['Applications']) {
                        echo "Available deployment types under 'Applications': ${ansibleVars['Applications'].keySet()}"
                        def deployment = ansibleVars['Applications'][params.deployment_type]
                        
                        if (deployment) {
                            echo "Selected deployment type: ${params.deployment_type}"
                            def extraVars = deployment.DeployExtraVars.collect { key, value -> "$key='$value'" }.join(' ')
                            echo "ExtraVars: ${extraVars}"
                        } else {
                            echo "No deployment found for the specified type under 'Applications': ${params.deployment_type}"
                        }
                    } else {
                        echo "The key 'Applications' was not found in ansibleVars."
                    }
                }
            }
        }
    }
}
